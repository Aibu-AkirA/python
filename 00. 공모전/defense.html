<!DOCTYPE html>
<html>
    <head>
        <title>練習</title>
        <meta charset="utf-8">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <style>
            #refereeBox{
                font-size: 30px;
            }
            #offdef{
                font-size: 50px;
            }
            .baseBox{
                width: 50px;
                height: 50px;
                padding: 20px;
                border: 1px solid black;
                margin: 10 10 10 10;
                background: white;
            }
            #three,#one{
                float: left;
            }
            #one{
                margin-left: 45px;
            }
            #two{
                margin-left: 70px;
            }
            .score{
                float: left;
                font-size: 20
            }
            #myT{
                margin-left: 10px;
            }
            #cpuT{
                margin-left: 45px;
            }
        </style>
        <script>
            var pitcher = 0;
            var batter = 0;
            var batChe = 0;
            var ballCount = 0;
            var strikeCount = 0;
            var outCount = 0;
            var inning = sessionStorage.getItem("inning")
            inning *= 1;
            var myTeamScore = sessionStorage.getItem("myTeamScore")
            myTeamScore *= 1;
            var cpuTeamScore = sessionStorage.getItem("cpuTeamScore")
            cpuTeamScore *= 1;
            var runner = [0,0,0,0]
            var runnerCount = 0;
            var baseBox = [0,0,0]
            var myInn = [0,0,0,0,0,0,0,0,0]
            var cpuInn = [0,0,0,0,0,0,0,0,0]
            var cpuScoreNow = 0;
            var cpuHit = sessionStorage.getItem("cpuTeamHit");
            cpuHit *= 1;
            var cpu4BAll = sessionStorage.getItem("cpuTeam4Ball");
            cpu4BAll *= 1;
            
            for(var i=1; i<10; i++){
                myInn[i-1] = sessionStorage.getItem("myInn"+i);
                myInn[i-1] *=1;
                cpuInn[i-1] = sessionStorage.getItem("cpuInn"+i)
                cpuInn[i-1] *=1;
            }
            
            function runnerScore(hit,rc){
                for (var i = 0; i < 4; i++){
                    if(runner[i] != 0){
                        runner[i] += hit
                        if(runner[i] > 3){
                            cpuTeamScore += 1;
                            cpuScoreNow += 1;
                            runner[i] = 0;
                        }
                    }
                }
                if(hit == 4){
                    cpuTeamScore += 1;
                    cpuScoreNow += 1;
                }else{
                    runner[rc] = hit;
                }
                if(runnerCount == 3){
                    runnerCount = 0
                }else{
                    runnerCount += 1;
                }
            }
            
            inning += 1;
            var inningNow = Math.ceil(inning/2)
            
            $(function(){
                $("#startBut").hide();
                $("#myT").html(myTeamScore);
                $("#cpuT").html(cpuTeamScore);
                $("#inning").html(inningNow);
                $("#cH").html(cpuTeamScore)
                
                for(var i=1; i<10; i++){
                    $("#m"+i).html(myInn[i-1]);
                    $("#c"+i).html(cpuInn[i-1]);
                }
                
                $("#readyBut").click(function(){
                    batter = Math.floor(Math.random() * 100) ;
                    $("#refereeBox").html("Ready!")
                    $("#readyBut").hide();
                    $("#startBut").show();
                })
                
                $("#startBut").click(function(){
                    $("#startBut").hide();
                    $("#readyBut").show();
                    pitcher = $("#pitcher").val();
                    
                    if(isNaN(pitcher) || pitcher == null){
                        $("#refereeBox").html("Ball!")
                        ballCount += 1;
                    }else if(pitcher < 1 || pitcher > 99){
                        $("#refereeBox").html("Ball!")
                        ballCount += 1;
                    }else if(batter == 0){
                        if(pitcher%5 == 0){
                            ballCount += 1;
                            $("#refereeBox").html("Ball!");
                        }else{
                            strikeCount += 1;
                            $("#refereeBox").html("Strike!");
                        }
                    }else{
                        if(pitcher == 50){
                            batChe = batter;
                        } else {
                            batChe = batter - (pitcher-50)
                            if(batChe > 99){
                                batChe -= 99;
                            }else if(batChe < 1){
                                batChe += 99;
                            }
                        }
                        
                        if(batChe >= 49 && batChe <= 51){
                            $("#refereeBox").html("HOME RUN!")
                            runnerScore(4,runnerCount)
                            cpuHit += 1;
                            ballCount = 0;
                            strikeCount = 0;
                        } else if(batChe >= 47 && batChe <= 53){
                            $("#refereeBox").html("Triple!")
                            runnerScore(3,runnerCount)
                            cpuHit += 1;
                            ballCount = 0;
                            strikeCount = 0;
                        } else if(batChe >= 42 && batChe <= 58){
                            $("#refereeBox").html("Doubles!")
                            runnerScore(2,runnerCount)
                            cpuHit += 1;
                            ballCount = 0;
                            strikeCount = 0;
                        } else if(batChe >= 33 && batChe <= 67){
                            $("#refereeBox").html("Hits!")
                            cpuHit += 1;
                            runnerScore(1,runnerCount)
                            ballCount = 0;
                            strikeCount = 0;
                        } else if(batChe >= 23 && batChe <= 77){
                            $("#refereeBox").html("Foul!")
                            if(strikeCount != 2){
                                strikeCount += 1;
                            }
                        } else if(batChe >= 11 && batChe <= 89){
                            if(batChe < 23){
                                $("#refereeBox").html("Ground Ball, Out!")
                            } else {
                                $("#refereeBox").html("Fly Ball, Out!")
                            }
                            outCount += 1;
                            ballCount = 0;
                            strikeCount = 0;
                        } else {
                            $("#refereeBox").html("false swing!")
                            strikeCount += 1;
                        }
                    }
                    
                    if(ballCount == 4){
                        $("#refereeBox").html("Four ball!")
                        runnerScore(1,runnerCount)
                        cpu4BAll += 1;
                        ballCount = 0;
                        strikeCount = 0;
                    }else if(strikeCount == 3){
                        $("#refereeBox").html("Strike out!")
                        outCount += 1;
                        ballCount = 0;
                        strikeCount = 0;
                    }
                    
                    $("#cpuT").html(cpuTeamScore);
                    $("#c"+inningNow).html(cpuScoreNow)
                    $("#BallScreen").html(ballCount);
                    $("#StrickScreen").html(strikeCount);
                    $("#OutScreen").html(outCount);
                    $("#batterScreen").html(batter);
                    $("#pitcherScreen").html(pitcher);
                    
                    baseBox = [0,0,0]
                    for(var i=0; i<4; i++){
                        if(runner[i] == 1) {
                            $("#one").css("background-color","blue");
                            baseBox[0] = 1;
                        }else if(runner[i] == 2){
                            $("#two").css("background-color","blue");
                            baseBox[1] = 1;
                        }else if(runner[i] == 3){
                            $("#three").css("background-color","blue");
                            baseBox[2] = 1;
                        }
                    }
                    
                    if(baseBox[0]==0){
                            $("#one").css("background-color","white");
                        }
                    if(baseBox[1]==0){
                            $("#two").css("background-color","white");
                        }
                    if(baseBox[2]==0){
                            $("#three").css("background-color","white");
                        }
                    
                    if(inning != 18 && outCount == 3) {
                        sessionStorage.setItem("cpuInn"+inningNow, cpuScoreNow);
                        sessionStorage.setItem("inning", inning);
                        sessionStorage.setItem("cpuTeamScore", cpuTeamScore);
                        $("#readyBut").hide();
                        setTimeout(function(){
                            location.replace('offensive.html');
                            }, 2000);
                    };
                    if(inning == 18 && outCount == 3) {
                        sessionStorage.setItem("cpuInn"+inningNow, cpuScoreNow);
                        sessionStorage.setItem("inning", inning);
                        sessionStorage.setItem("cpuTeamScore", cpuTeamScore);
                        $("#readyBut").hide();
                        setTimeout(function(){
                            location.replace('finish.html');
                            }, 2000);
                    };
                });
            });
            
        </script>
    </head>
    <body>
        <div id="offdef"> 守備です！</div>
        <div style="float: left; font-size: 20px" id="inning"></div>
        <div style="float: left; font-size: 20px">回です！</div>
        <div>
            <input type="button" value="READY" id="readyBut">
            <p>必ずREADYボタンをクリックしてください！</p>
        </div>    
        <div>
            <p>0~99まで入力してください。</p>
            <input type="text" value="" id="pitcher">
            <input type="button" value="start" id="startBut">
        </div>
        Referee
        <div id="refereeBox"></div>
        <br><br>
        Pitcher
        <div id="pitcherScreen" ></div>
        Batter
        <div id="batterScreen"></div>
        <br><br>
        Ball
        <div id="BallScreen"></div>
        Strik
        <div id="StrickScreen"></div>
        Out
        <div id="OutScreen"></div>
        <br><br>
        <div class="baseBox" id="two">2</div>
        <br>
        <div class="baseBox" id="three" >3</div>
        <div class="baseBox" id="one" >1</div>
        <br><br><br><br><br><br>
        <div style="font-size: 20px">MY - CPU</div>
        <div class="score" id="myT"></div>
        <div class="score" id="cpuT"></div>
        <br>
        <table>
            <tr><th></th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>R</th><th>H</th><th>B</th></tr>
            <tr><th>MY</th><td id="m1">0</td><td id="m2">0</td><td id="m3">0</td><td id="m4">0</td><td id="m5">0</td><td id="m6">0</td><td id="m7">0</td><td id="m8">0</td><td id="m9">0</td><td id="mR">0</td><td id="mH">0</td><td id="mB">0</td></tr>
            <tr><th>CPU</th><td id="c1">0</td><td id="c2">0</td><td id="c3">0</td><td id="c4">0</td><td id="c5">0</td><td id="c6">0</td><td id="c7">0</td><td id="c8">0</td><td id="c9">0</td><td id="cH">0</td><td id="cR">0</td><td id="cB">0</td></tr>
        </table>
        
    </body>
</html>